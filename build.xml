<?xml version="1.0" ?>

<project name="gui:config" default="dist">
	<property name="src.dir" value="." />
	<property name="dist.dir" value="${basedir}/dist" />
	<property name="app.name" value="guiconfig" />
	<property name="app.id" value="guiconfig@slosd.net" />
	<property name="app.version" value="0.4.3" />
	<property name="app.build" value="final" />
	
	<target name="chrome">
		<mkdir dir="${dist.dir}" />
		<zip destfile="${dist.dir}/${app.name}.jar">
			<fileset dir="${src.dir}">
				<include name="content/**" />
				<include name="locale/en-US/**" />
				<include name="locale/de-DE/**" />
				<include name="locale/it-IT/**" />
				<include name="locale/pl-PL/**" />
				<include name="locale/pt-BR/**" />
				<include name="locale/zh-TW/**" />
				<include name="locale/zh-CN/**" />
				<!--<include name="locale/fr-FR/**" />
				<include name="locale/es-ES/**" />
				<include name="locale/nb-NO/**" />
				<include name="locale/ru-RU/**" />-->
				<include name="skin/**" />
				<exclude name="**/.*" />
				<exclude name="**/CVS/**" />
			</fileset>
		</zip>
		<copy file="chrome:jar.manifest" todir="${dist.dir}" overwrite="true" />
		<move file="${dist.dir}/chrome:jar.manifest" tofile="${dist.dir}/chrome.manifest" overwrite="true" />
	</target>

	<target name="test.chrome" depends="chrome" if="ff.present">
		<copy file="${dist.dir}/${app.name}.jar" todir="${ff.dir}/chrome/chrome" overwrite="true" />
		<copy file="${src.dir}/chrome.manifest" tofile="${ff.dir}/chrome/${app.name}.manifest" overwrite="true" />
	</target>
	
	<!-- copy to extensions directory -->
	<!--
	<target name="test.ext" depends="chrome" if="ff.present">
		<copy file="${dist.dir}/${app.name}.jar" todir="${ff.dir}/extensions/${app.id}/chrome" overwrite="true" />
		<copy file="${src.dir}/chrome.manifest" todir="${ff.dir}/extensions/${app.id}" overwrite="true" />
	</target>
	-->
	
	<target name="dist" depends="chrome">
		<zip destfile="${dist.dir}/${app.name}_${app.version}_${app.build}.xpi">
			<zipfileset file="${dist.dir}/${app.name}.jar" prefix="chrome"/>
			<zipfileset file="${dist.dir}/chrome.manifest" prefix="" />
			<fileset dir="${src.dir}">
				<include name="install.rdf" />
				<include name="defaults/**" />
				<exclude name="**/.*" />
				<exclude name="**/CVS/**" />
			</fileset>
		</zip>
		<delete file="${dist.dir}/${app.name}.jar" />
		<delete file="${dist.dir}/chrome.manifest" />
	</target>
	
	<target name="clean.ff"  if="ff.present">
		<delete dir="${ff.dir}/extensions/${app.id}" failonerror="false" />
		<delete file="${ff.dir}/chrome/${app.name}.manifest" failonerror="false" />
		<delete file="${ff.dir}/chrome/chrome/${app.name}.jar" failonerror="false" />
	</target>

</project>
